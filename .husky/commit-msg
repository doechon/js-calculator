#!/usr/bin/env sh

COMMIT_MSG=$(cat "$1")

if echo "$COMMIT_MSG" | grep -q "^\(feat\|fix\):"; then
    if ! echo "$COMMIT_MSG" | grep -q "^\(feat\|fix\): #[0-9]"; then
        echo "‚ùå –û—à–∏–±–∫–∞: feat –∏ fix –∫–æ–º–º–∏—Ç—ã –¥–æ–ª–∂–Ω—ã —Å–æ–¥–µ—Ä–∂–∞—Ç—å –Ω–æ–º–µ—Ä –∑–∞–¥–∞—á–∏: feat: #123 –æ–ø–∏—Å–∞–Ω–∏–µ"
        echo "‚úÖ –ü—Ä–∏–º–µ—Ä: feat: #9 –¥–æ–±–∞–≤–∏—Ç—å —Ç—ë–º–Ω—É—é —Ç–µ–º—É"
        exit 1
    fi
fi

if echo "$COMMIT_MSG" | grep -q "^fix: #[0-9]"; then
    ISSUE_NUMBER=$(echo "$COMMIT_MSG" | grep -o '#[0-9]*' | sed 's/#//')
    echo "üîß –ó–∞–∫—Ä—ã–≤–∞—é issue #$ISSUE_NUMBER..."
    
    # –ü–æ–ª—É—á–∞–µ–º —Ö—ç—à –∫–æ–º–º–∏—Ç–∞ (–±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ—Å–ª–µ –∫–æ–º–º–∏—Ç–∞)
    COMMIT_HASH=$(git rev-parse --short HEAD)
    REPO_URL=$(git remote get-url origin | sed 's/\.git$//')
    
    # –°–æ–∑–¥–∞—ë–º —Å—Å—ã–ª–∫—É –Ω–∞ –∫–æ–º–º–∏—Ç
    COMMIT_URL="$REPO_URL/commit/$COMMIT_HASH"
    
    gh issue close "$ISSUE_NUMBER" --comment "–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ –∫–æ–º–º–∏—Ç–µ: [$COMMIT_HASH]($COMMIT_URL) - $COMMIT_MSG"
fi

npx --no -- commitlint --edit "$1"